Master :
ssh ubuntu@18.117.190.156

Multi-Container Pods
================================
10.3. Init Containers
================================
Start-Up tasks for your application
============================
=> Get data from DB
=> Third-Party Dependency Checks
=> Setup Scripts
etc.

=> Init Containers are specialized containers that run before Main app container.

=> Init containers can contain utilities or setup scripts not present in Main app container.

=> You can specify init containers in the Pod specification alongside the containers array

=> Pod can have multiple init containers which are run before the app containers are started.

=> Init containers are exactly like regular containers, except:

1) Init containers always run to completion.
2) Each init container must complete successfully before the next one starts.
3) If a Pod's init container fails, the kubelet repeatedly restarts that init container until it succeeds. 
However, if the Pod has a restartPolicy of Never, and an init container fails during startup of that Pod, Kubernetes treats the overall Pod as failed.

4) Pod cannot be Ready until all init containers have succeeded


============================
mypod46.yml
====================
apiVersion: v1
kind: Pod
metadata:
  name: jlcpod
spec:
  restartPolicy: Never
  volumes:
  - name: myjlc-volume
    emptyDir: {}

  containers:
  - name: nginx-container
    image: nginx
    volumeMounts:
    - name: myjlc-volume
      mountPath: /usr/share/nginx/html
      
  - name: ubuntu-container
    image: ubuntu
    volumeMounts:
    - name: myjlc-volume
      mountPath: /myjlcdata
    command: ["/bin/sh"]
    args: ["-c", "echo Hello JLC Guys !!! I am from Init Container > /myjlcdata/index.html"]
    
=======================================
scp mypod46.yml ubuntu@18.222.26.49:/home/ubuntu/multi-containers
=============================

kubectl create -f mypod46.yml

kubectl get pods

kubectl describe pod jlcpod


kubectl exec jlcpod -c nginx-container --  cat /usr/share/nginx/html/index.html

kubectl delete pod jlcpod

============================
mypod47.yml
====================
apiVersion: v1
kind: Pod
metadata:
  name: jlcpod
spec:
  restartPolicy: Never
  volumes:
  - name: myjlc-volume
    emptyDir: {}

  containers:
  - name: nginx-container
    image: nginx
    volumeMounts:
    - name: myjlc-volume
      mountPath: /usr/share/nginx/html
      
  initContainers:

  - name: busybox-container
    image: busybox
    volumeMounts:
    - name: myjlc-volume
      mountPath: /mydata2
    command: ["/bin/sh"]
    args: ["-c", "echo Hello Guys !!! I am from busybox Init Container >> /mydata2/index.html"]
 
  - name: ubuntu-container
    image: ubuntu
    volumeMounts:
    - name: myjlc-volume
      mountPath: /mydata1
    command: ["/bin/sh"]
    args: ["-c", "echo Hello Guys !!! I am from ubuntu Init Container >> /mydata1/index.html"]
s
=======================================
scp mypod47.yml ubuntu@18.222.26.49:/home/ubuntu/multi-containers
=============================

kubectl create -f mypod47.yml

kubectl get pods

kubectl describe pod jlcpod


kubectl exec jlcpod -c nginx-container --  cat /usr/share/nginx/html/index.html

kubectl delete pod jlcpod


Init Containers  Vs Sidecar Containers Vs Main Containers
---------------------------------------------------------------------------
=> Init containers run and exit before your main application starts
=> Sidecars run side-by-side with your main container(s) and provide some kind of service for them.
=> Main Container runs and provides the service to end users
